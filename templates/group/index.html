<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevChat Web版</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='home/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='group/styles.css') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>
<body class="bg-black">
    <!-- Image and text -->
    <nav class="navbar app-bar fixed-top">
        <div class="container-fluid">
            <div class="row">
                <div class="col-2">
                    <a href="/home">
                        <img src="https://devchat.jp/images/back-removebg-preview.png" alt="" class="back justify-content-center">
                    </a>
                </div>
                <div class="col">
                    <p class="title">
                        {{group_name}}
                    </p>
                </div>
            </div>
        </div>
    </nav>
    <div class="line-bc">
        {% for message in datas %}
        {% if message['uid'] != uid %}
        <small class="user_name">{{message['name']}}</small>
        <div class="balloon6">
            <div class="faceicon">
                <img src="{{message['icon_url']}}" alt="">
            </div>
            <div class="chatting">
                {% if message['type'] == "text" %}
                <div class="says">
                    <p>{{message['content']}}</p>
                </div>
                {% elif message['type'] == "image" %}
                <img src="{{message['content']}}" alt="">
                {% endif %}
            </div>
        </div>
        {% elif message['uid'] == uid %}
        <div class="mycomment">
            {% if message['type'] == "text" %}
              <p>{{message['content']}}</p>
            {% elif message['type'] == "image" %}
            <img src="{{message['content']}}" alt="">
            {% endif %}
        </div>
        {% endif %}
        {% endfor %}
    </div>
        <div class="fixed-bottom input-group flex-nowrap">
            <textarea name="text" id="text" class="form-control" placeholder="メッセージを入力"></textarea>
            <button type="submit" class="input-group-text" onclick="sendTextMessage()">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="16" fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                  </svg>
            </button>
        </div>
    </div>
    <script>
        window.onload = function () {
            var element = document.documentElement;
            var bottom = element.scrollHeight - element.clientHeight;
            window.scroll(0, bottom);
        }
        function sendTextMessage() {
            text = $("#text").val();
            $.ajax({
                url: "/send_text_message",
                type: "POST",
                cache: false,
                dataType: "json",
                contentType: 'application/json', 
                data: JSON.stringify({
                    "from" :"{{uid}}",
                    "to": "{{gid}}",
                    "message": {
                        "type": "text",
                        "content": text
                    }
                }),
                success: function(o) {
                    if(o.status == "success") {
                        location.reload()
                    }
                },
                error: function(xhr, textStatus, errorThrown) {
                    alert("Error")
                }
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
</body>
</html>